
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Checksums and Their Use in ZFS &#8212; OpenZFS  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Troubleshooting" href="Troubleshooting.html" />
    <link rel="prev" title="Basic concepts" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="checksums-and-their-use-in-zfs">
<h1>Checksums and Their Use in ZFS<a class="headerlink" href="#checksums-and-their-use-in-zfs" title="Permalink to this headline">¶</a></h1>
<p>End-to-end checksums are a key feature of ZFS and an important
differentiator for ZFS over other RAID implementations and filesystems.
Advantages of end-to-end checksums include:</p>
<ul class="simple">
<li>detects data corruption upon reading from media</li>
<li>blocks that are detected as corrupt are automatically repaired if
possible, by using the RAID protection in suitably configured pools,
or redundant copies (see the zfs <code class="docutils literal notranslate"><span class="pre">copies</span></code> property)</li>
<li>periodic scrubs can check data to detect and repair latent media
degradation (bit rot) and corruption from other sources</li>
<li>checksums on ZFS replication streams, <code class="docutils literal notranslate"><span class="pre">zfs</span> <span class="pre">send</span></code> and
<code class="docutils literal notranslate"><span class="pre">zfs</span> <span class="pre">receive</span></code>, ensure the data received is not corrupted by
intervening storage or transport mechanisms</li>
</ul>
<div class="section" id="checksum-algorithms">
<h2>Checksum Algorithms<a class="headerlink" href="#checksum-algorithms" title="Permalink to this headline">¶</a></h2>
<p>The checksum algorithms in ZFS can be changed for datasets (filesystems
or volumes). The checksum algorithm used for each block is stored in the
block pointer (metadata). The block checksum is calculated when the
block is written, so changing the algorithm only affects writes
occurring after the change.</p>
<p>The checksum algorithm for a dataset can be changed by setting the
<code class="docutils literal notranslate"><span class="pre">checksum</span></code> property:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zfs</span> <span class="nb">set</span> <span class="n">checksum</span><span class="o">=</span><span class="n">sha256</span> <span class="n">pool_name</span><span class="o">/</span><span class="n">dataset_name</span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="27%" />
<col width="27%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Checksum</th>
<th class="head">Ok for dedup
and nopwrite?</th>
<th class="head">Compatible with
other ZFS
i
mplementations?</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>on</td>
<td>see notes</td>
<td>yes</td>
<td><code class="docutils literal notranslate"><span class="pre">on</span></code> is a
short hand for
<code class="docutils literal notranslate"><span class="pre">fletcher4</span></code>
for non-deduped
datasets and
<code class="docutils literal notranslate"><span class="pre">sha256</span></code> for
deduped
datasets</td>
</tr>
<tr class="row-odd"><td>off</td>
<td>no</td>
<td>yes</td>
<td>Do not do use
<code class="docutils literal notranslate"><span class="pre">off</span></code></td>
</tr>
<tr class="row-even"><td>fletcher2</td>
<td>no</td>
<td>yes</td>
<td>Deprecated
implementation
of Fletcher
checksum, use
<code class="docutils literal notranslate"><span class="pre">fletcher4</span></code>
instead</td>
</tr>
<tr class="row-odd"><td>fletcher4</td>
<td>no</td>
<td>yes</td>
<td>Fletcher
algorithm, also
used for
<code class="docutils literal notranslate"><span class="pre">zfs</span> <span class="pre">send</span></code>
streams</td>
</tr>
<tr class="row-even"><td>sha256</td>
<td>yes</td>
<td>yes</td>
<td>Default for
deduped
datasets</td>
</tr>
<tr class="row-odd"><td>noparity</td>
<td>no</td>
<td>yes</td>
<td>Do not use
<code class="docutils literal notranslate"><span class="pre">noparity</span></code></td>
</tr>
<tr class="row-even"><td>sha512</td>
<td>yes</td>
<td>requires pool
feature
<code class="docutils literal notranslate"><span class="pre">org.</span>
<span class="pre">illumos:sha512</span></code></td>
<td>salted
<code class="docutils literal notranslate"><span class="pre">sha512</span></code>
currently not
supported for
any filesystem
on the boot
pools</td>
</tr>
<tr class="row-odd"><td>skein</td>
<td>yes</td>
<td>requires pool
feature
<code class="docutils literal notranslate"><span class="pre">org.</span>
<span class="pre">illumos:skein</span></code></td>
<td>salted
<code class="docutils literal notranslate"><span class="pre">skein</span></code>
currently not
supported for
any filesystem
on the boot
pools</td>
</tr>
<tr class="row-even"><td>edonr</td>
<td>yes</td>
<td>requires pool
feature
<code class="docutils literal notranslate"><span class="pre">org.</span>
<span class="pre">illumos:edonr</span></code></td>
<td>salted
<code class="docutils literal notranslate"><span class="pre">edonr</span></code>
currently not
supported for
any filesystem
on the boot
pools</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="checksum-accelerators">
<h2>Checksum Accelerators<a class="headerlink" href="#checksum-accelerators" title="Permalink to this headline">¶</a></h2>
<p>ZFS has the ability to offload checksum operations to the Intel
QuickAssist Technology (QAT) adapters.</p>
</div>
<div class="section" id="checksum-microbenchmarks">
<h2>Checksum Microbenchmarks<a class="headerlink" href="#checksum-microbenchmarks" title="Permalink to this headline">¶</a></h2>
<p>Some ZFS features use microbenchmarks when the <code class="docutils literal notranslate"><span class="pre">zfs.ko</span></code> kernel module
is loaded to determine the optimal algorithm for checksums. The results
of the microbenchmarks are observable in the <code class="docutils literal notranslate"><span class="pre">/proc/spl/kstat/zfs</span></code>
directory. The winning algorithm is reported as the “fastest” and
becomes the default. The default can be overridden by setting zfs module
parameters.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="52%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Checksum</th>
<th class="head">Results Filename</th>
<th class="head"><code class="docutils literal notranslate"><span class="pre">zfs</span></code> module parameter</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Fletcher4</td>
<td>/proc/spl/kstat/zfs/fletcher_4_bench</td>
<td>zfs_fletcher_4_impl</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="disabling-checksums">
<h2>Disabling Checksums<a class="headerlink" href="#disabling-checksums" title="Permalink to this headline">¶</a></h2>
<p>While it may be tempting to disable checksums to improve CPU
performance, it is widely considered by the ZFS community to be an
extrodinarily bad idea. Don’t disable checksums.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static//img/320px-Open-ZFS-Secondary-Logo-Colour-halfsize.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Getting Started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Project and Community/index.html">Project and Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Developer Resources/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Performance and tuning/index.html">Performance and tuning</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Basic concepts</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Checksums and Their Use in ZFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="dRAID Howto.html">dRAID Howto</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../License.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Basic concepts</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Basic concepts</a></li>
      <li>Next: <a href="Troubleshooting.html" title="next chapter">Troubleshooting</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, OpenZFS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Basics concepts/Checksums.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>