
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Debian GNU Linux initrd documentation &#8212; OpenZFS  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fedora" href="../Fedora.html" />
    <link rel="prev" title="Debian Stretch Root on ZFS" href="Debian Stretch Root on ZFS.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="debian-gnu-linux-initrd-documentation">
<h1>Debian GNU Linux initrd documentation<a class="headerlink" href="#debian-gnu-linux-initrd-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="supported-boot-parameters">
<h2>Supported boot parameters<a class="headerlink" href="#supported-boot-parameters" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>rollback=&lt;on|yes|1&gt; Do a rollback of specified snapshot.</li>
<li>zfs_debug=&lt;on|yes|1&gt; Debug the initrd script</li>
<li>zfs_force=&lt;on|yes|1&gt; Force importing the pool. Should not be
necessary.</li>
<li>zfs=&lt;off|no|0&gt; Don’t try to import ANY pool, mount ANY filesystem or
even load the module.</li>
<li>rpool=&lt;pool&gt; Use this pool for root pool.</li>
<li>bootfs=&lt;pool&gt;/&lt;dataset&gt; Use this dataset for root filesystem.</li>
<li>root=&lt;pool&gt;/&lt;dataset&gt; Use this dataset for root filesystem.</li>
<li>root=ZFS=&lt;pool&gt;/&lt;dataset&gt; Use this dataset for root filesystem.</li>
<li>root=zfs:&lt;pool&gt;/&lt;dataset&gt; Use this dataset for root filesystem.</li>
<li>root=zfs:AUTO Try to detect both pool and rootfs</li>
</ul>
<p>In all these cases, &lt;dataset&gt; could also be &lt;dataset&gt;&#64;&lt;snapshot&gt;.</p>
<p>The reason there are so many supported boot options to get the root
filesystem, is that there are a lot of different ways too boot ZFS out
there, and I wanted to make sure I supported them all.</p>
</div>
<div class="section" id="pool-imports">
<h2>Pool imports<a class="headerlink" href="#pool-imports" title="Permalink to this headline">¶</a></h2>
<div class="section" id="import-using-dev-disk-by">
<h3>Import using /dev/disk/by-*<a class="headerlink" href="#import-using-dev-disk-by" title="Permalink to this headline">¶</a></h3>
<p>The initrd will, if the variable USE_DISK_BY_ID is set in the file
/etc/default/zfs, to import using the /dev/disk/by-* links. It will try
to import in this order:</p>
<ol class="arabic simple">
<li>/dev/disk/by-vdev</li>
<li>/dev/disk/by-*</li>
<li>/dev</li>
</ol>
</div>
<div class="section" id="import-using-cache-file">
<h3>Import using cache file<a class="headerlink" href="#import-using-cache-file" title="Permalink to this headline">¶</a></h3>
<p>If all of these imports fail (or if USE_DISK_BY_ID is unset), it will
then try to import using the cache file.</p>
</div>
<div class="section" id="last-ditch-attempt-at-importing">
<h3>Last ditch attempt at importing<a class="headerlink" href="#last-ditch-attempt-at-importing" title="Permalink to this headline">¶</a></h3>
<p>If that ALSO fails, it will try one more time, without any -d or -c
options.</p>
</div>
</div>
<div class="section" id="booting">
<h2>Booting<a class="headerlink" href="#booting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="booting-from-snapshot">
<h3>Booting from snapshot:<a class="headerlink" href="#booting-from-snapshot" title="Permalink to this headline">¶</a></h3>
<p>Enter the snapshot for the root= parameter like in this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>linux   /ROOT/debian-1@/boot/vmlinuz-3.2.0-4-amd64 root=ZFS=rpool/ROOT/debian-1@some_snapshot ro boot=zfs $bootfs quiet
</pre></div>
</div>
<p>This will clone the snapshot <a class="reference external" href="mailto:rpool/ROOT/debian-1&#37;&#52;&#48;some_snapshot">rpool/ROOT/debian-1<span>&#64;</span>some_snapshot</a> into the
filesystem rpool/ROOT/debian-1_some_snapshot and use that as root
filesystem. The original filesystem and snapshot is left alone in this
case.</p>
<p><strong>BEWARE</strong> that it will first destroy, blindingly, the
rpool/ROOT/debian-1_some_snapshot filesystem before trying to clone the
snapshot into it again. So if you’ve booted from the same snapshot
previously and done some changes in that root filesystem, they will be
undone by the destruction of the filesystem.</p>
</div>
<div class="section" id="snapshot-rollback">
<h3>Snapshot rollback<a class="headerlink" href="#snapshot-rollback" title="Permalink to this headline">¶</a></h3>
<p>From version 0.6.4-1-3 it is now also possible to specify rollback=1 to
do a rollback of the snapshot instead of cloning it. <strong>BEWARE</strong> that
this will destroy <em>all</em> snapshots done after the specified snapshot!</p>
</div>
<div class="section" id="select-snapshot-dynamically">
<h3>Select snapshot dynamically<a class="headerlink" href="#select-snapshot-dynamically" title="Permalink to this headline">¶</a></h3>
<p>From version 0.6.4-1-3 it is now also possible to specify a NULL
snapshot name (such as root=rpool/ROOT/debian-1&#64;) and if so, the initrd
script will discover all snapshots below that filesystem (sans the at),
and output a list of snapshot for the user to choose from.</p>
</div>
<div class="section" id="booting-from-native-encrypted-filesystem">
<h3>Booting from native encrypted filesystem<a class="headerlink" href="#booting-from-native-encrypted-filesystem" title="Permalink to this headline">¶</a></h3>
<p>Although there is currently no support for native encryption in ZFS On
Linux, there is a patch floating around ‘out there’ and the initrd
supports loading key and unlock such encrypted filesystem.</p>
</div>
<div class="section" id="separated-filesystems">
<h3>Separated filesystems<a class="headerlink" href="#separated-filesystems" title="Permalink to this headline">¶</a></h3>
<div class="section" id="descended-filesystems">
<h4>Descended filesystems<a class="headerlink" href="#descended-filesystems" title="Permalink to this headline">¶</a></h4>
<p>If there are separate filesystems (for example a separate dataset for
/usr), the snapshot boot code will try to find the snapshot under each
filesystems and clone (or rollback) them.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpool</span><span class="o">/</span><span class="n">ROOT</span><span class="o">/</span><span class="n">debian</span><span class="o">-</span><span class="mi">1</span><span class="nd">@some_snapshot</span>
<span class="n">rpool</span><span class="o">/</span><span class="n">ROOT</span><span class="o">/</span><span class="n">debian</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">usr</span><span class="nd">@some_snapshot</span>
</pre></div>
</div>
<p>These will create the following filesystems respectively (if not doing a
rollback):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpool</span><span class="o">/</span><span class="n">ROOT</span><span class="o">/</span><span class="n">debian</span><span class="o">-</span><span class="mi">1</span><span class="n">_some_snapshot</span>
<span class="n">rpool</span><span class="o">/</span><span class="n">ROOT</span><span class="o">/</span><span class="n">debian</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">usr_some_snapshot</span>
</pre></div>
</div>
<p>The initrd code will use the mountpoint option (if any) in the original
(without the snapshot part) dataset to find <em>where</em> it should mount the
dataset. Or it will use the name of the dataset below the root
filesystem (rpool/ROOT/debian-1 in this example) for the mount point.</p>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static//img/320px-Open-ZFS-Secondary-Logo-Colour-halfsize.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference external" href="https://wiki.archlinux.org/index.php/ZFS">ArchLinux</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Debian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Fedora.html">Fedora</a></li>
<li class="toctree-l2"><a class="reference external" href="https://zfsonfreebsd.github.io/ZoF/">FreeBSD</a></li>
<li class="toctree-l2"><a class="reference external" href="https://wiki.gentoo.org/wiki/ZFS">Gentoo</a></li>
<li class="toctree-l2"><a class="reference external" href="https://software.opensuse.org/package/zfs">openSUSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../RHEL and CentOS.html">RHEL and CentOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Ubuntu/index.html">Ubuntu</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Project and Community/index.html">Project and Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer Resources/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Performance and tuning/index.html">Performance and tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Basics concepts/index.html">Basic concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../License.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Getting Started</a><ul>
  <li><a href="index.html">Debian</a><ul>
      <li>Previous: <a href="Debian Stretch Root on ZFS.html" title="previous chapter">Debian Stretch Root on ZFS</a></li>
      <li>Next: <a href="../Fedora.html" title="next chapter">Fedora</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, OpenZFS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/Getting Started/Debian/Debian GNU Linux initrd documentation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>