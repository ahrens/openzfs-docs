
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Building ZFS &#8212; OpenZFS  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Buildbot Options" href="Buildbot Options.html" />
    <link rel="prev" title="Custom Packages" href="Custom Packages.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="building-zfs">
<h1>Building ZFS<a class="headerlink" href="#building-zfs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="github-repositories">
<h2>GitHub Repositories<a class="headerlink" href="#github-repositories" title="Permalink to this headline">¶</a></h2>
<p>The official source for ZFS on Linux is maintained at GitHub by the
<a class="reference external" href="https://github.com/zfsonlinux/">zfsonlinux</a> organization. The
project consists of two primary git repositories named
<a class="reference external" href="https://github.com/zfsonlinux/spl">spl</a> and
<a class="reference external" href="https://github.com/zfsonlinux/zfs">zfs</a>, both are required to build
ZFS on Linux.</p>
<p><strong>NOTE:</strong> The SPL was merged in to the
<a class="reference external" href="https://github.com/zfsonlinux/zfs">zfs</a> repository, the last major
release with a separate SPL is <code class="docutils literal notranslate"><span class="pre">0.7</span></code>.</p>
<ul class="simple">
<li><strong>SPL</strong>: The SPL is thin shim layer which is responsible for
implementing the fundamental interfaces required by OpenZFS. It’s
this layer which allows OpenZFS to be used across multiple platforms.</li>
<li><strong>ZFS</strong>: The ZFS repository contains a copy of the upstream OpenZFS
code which has been adapted and extended for Linux. The vast majority
of the core OpenZFS code is self-contained and can be used without
modification.</li>
</ul>
</div>
<div class="section" id="installing-dependencies">
<h2>Installing Dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The first thing you’ll need to do is prepare your environment by
installing a full development tool chain. In addition, development
headers for both the kernel and the following libraries must be
available. It is important to note that if the development kernel
headers for the currently running kernel aren’t installed, the modules
won’t compile properly.</p>
<p>The following dependencies should be installed to build the latest ZFS
0.8 release.</p>
<ul class="simple">
<li><strong>RHEL/CentOS 7</strong>:</li>
</ul>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span>sudo yum install epel-release gcc make autoconf automake libtool rpm-build dkms libtirpc-devel libblkid-devel libuuid-devel libudev-devel openssl-devel zlib-devel libaio-devel libattr-devel elfutils-libelf-devel kernel-devel-$(uname -r) python python2-devel python-setuptools python-cffi libffi-devel
</pre></div>
</div>
<ul class="simple">
<li><strong>RHEL/CentOS 8, Fedora</strong>:</li>
</ul>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span>sudo dnf install gcc make autoconf automake libtool rpm-build dkms libtirpc-devel libblkid-devel libuuid-devel libudev-devel openssl-devel zlib-devel libaio-devel libattr-devel elfutils-libelf-devel kernel-devel-$(uname -r) python3 python3-devel python3-setuptools python3-cffi libffi-devel
</pre></div>
</div>
<ul class="simple">
<li><strong>Debian, Ubuntu</strong>:</li>
</ul>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span>sudo apt install build-essential autoconf automake libtool gawk alien fakeroot dkms libblkid-dev uuid-dev libudev-dev libssl-dev zlib1g-dev libaio-dev libattr1-dev libelf-dev linux-headers-$(uname -r) python3 python3-dev python3-setuptools python3-cffi libffi-dev
</pre></div>
</div>
</div>
<div class="section" id="build-options">
<h2>Build Options<a class="headerlink" href="#build-options" title="Permalink to this headline">¶</a></h2>
<p>There are two options for building ZFS on Linux, the correct one largely
depends on your requirements.</p>
<ul class="simple">
<li><strong>Packages</strong>: Often it can be useful to build custom packages from
git which can be installed on a system. This is the best way to
perform integration testing with systemd, dracut, and udev. The
downside to using packages it is greatly increases the time required
to build, install, and test a change.</li>
<li><strong>In-tree</strong>: Development can be done entirely in the SPL and ZFS
source trees. This speeds up development by allowing developers to
rapidly iterate on a patch. When working in-tree developers can
leverage incremental builds, load/unload kernel modules, execute
utilities, and verify all their changes with the ZFS Test Suite.</li>
</ul>
<p>The remainder of this page focuses on the <strong>in-tree</strong> option which is
the recommended method of development for the majority of changes. See
the <a class="reference internal" href="Custom Packages.html"><span class="doc">custom packages</span></a> page for additional information on building
custom packages.</p>
</div>
<div class="section" id="developing-in-tree">
<h2>Developing In-Tree<a class="headerlink" href="#developing-in-tree" title="Permalink to this headline">¶</a></h2>
<div class="section" id="clone-from-github">
<h3>Clone from GitHub<a class="headerlink" href="#clone-from-github" title="Permalink to this headline">¶</a></h3>
<p>Start by cloning the SPL and ZFS repositories from GitHub. The
repositories have a <strong>master</strong> branch for development and a series of
<strong>*-release</strong> branches for tagged releases. After checking out the
repository your clone will default to the master branch. Tagged releases
may be built by checking out spl/zfs-x.y.z tags with matching version
numbers or matching release branches. Avoid using mismatched versions,
this can result build failures due to interface changes.</p>
<p><strong>NOTE:</strong> SPL was merged in to the
<a class="reference external" href="https://github.com/zfsonlinux/zfs">zfs</a> repository, last release
with separate SPL is <code class="docutils literal notranslate"><span class="pre">0.7</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">zfsonlinux</span><span class="o">/</span><span class="n">zfs</span>
</pre></div>
</div>
<p>If you need 0.7 release or older:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">zfsonlinux</span><span class="o">/</span><span class="n">spl</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-and-build">
<h3>Configure and Build<a class="headerlink" href="#configure-and-build" title="Permalink to this headline">¶</a></h3>
<p>For developers working on a change always create a new topic branch
based off of master. This will make it easy to open a pull request with
your change latter. The master branch is kept stable with extensive
<a class="reference external" href="http://build.zfsonlinux.org/">regression testing</a> of every pull
request before and after it’s merged. Every effort is made to catch
defects as early as possible and to keep them out of the tree.
Developers should be comfortable frequently rebasing their work against
the latest master branch.</p>
<p>If you want to build 0.7 release or older, you should compile SPL first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd ./spl
git checkout master
sh autogen.sh
./configure
make -s -j$(nproc)
</pre></div>
</div>
<p>In this example we’ll use the master branch and walk through a stock
<strong>in-tree</strong> build, so we don’t need to build SPL separately. Start by
checking out the desired branch then build the ZFS and SPL source in the
tradition autotools fashion.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd ./zfs
git checkout master
sh autogen.sh
./configure
make -s -j$(nproc)
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>tip:</strong> <code class="docutils literal notranslate"><span class="pre">--with-linux=PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">--with-linux-obj=PATH</span></code> can be
passed to configure to specify a kernel installed in a non-default
location. This option is also supported when building ZFS.</div>
<div class="line"><strong>tip:</strong> <code class="docutils literal notranslate"><span class="pre">--enable-debug</span></code> can be set to enable all ASSERTs and
additional correctness tests. This option is also supported when
building ZFS.</div>
<div class="line"><strong>tip:</strong> for version <code class="docutils literal notranslate"><span class="pre">&lt;=0.7</span></code> <code class="docutils literal notranslate"><span class="pre">--with-spl=PATH</span></code> and
<code class="docutils literal notranslate"><span class="pre">--with-spl-obj=PATH</span></code>, where <code class="docutils literal notranslate"><span class="pre">PATH</span></code> is a full path, can be passed
to configure if it is unable to locate the SPL.</div>
</div>
<p><strong>Optional</strong> Build packages</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">deb</span> <span class="c1">#example for Debian/Ubuntu</span>
</pre></div>
</div>
</div>
<div class="section" id="install">
<h3>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h3>
<p>You can run <code class="docutils literal notranslate"><span class="pre">zfs-tests.sh</span></code> without installing ZFS, see below. If you
have reason to install ZFS after building it, pay attention to how your
distribution handles kernel modules. On Ubuntu, for example, the modules
from this repository install in the <code class="docutils literal notranslate"><span class="pre">extra</span></code> kernel module path, which
is not in the standard <code class="docutils literal notranslate"><span class="pre">depmod</span></code> search path. Therefore, for the
duration of your testing, edit <code class="docutils literal notranslate"><span class="pre">/etc/depmod.d/ubuntu.conf</span></code> and add
<code class="docutils literal notranslate"><span class="pre">extra</span></code> to the beginning of the search path.</p>
<p>You may then install using
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">make</span> <span class="pre">install;</span> <span class="pre">sudo</span> <span class="pre">ldconfig;</span> <span class="pre">sudo</span> <span class="pre">depmod</span></code>. You’d uninstall with
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">make</span> <span class="pre">uninstall;</span> <span class="pre">sudo</span> <span class="pre">ldconfig;</span> <span class="pre">sudo</span> <span class="pre">depmod</span></code>.</p>
</div>
<div class="section" id="running-zloop-sh-and-zfs-tests-sh">
<span id="running-zloopsh-and-zfs-testssh"></span><h3>Running zloop.sh and zfs-tests.sh<a class="headerlink" href="#running-zloop-sh-and-zfs-tests-sh" title="Permalink to this headline">¶</a></h3>
<p>If you wish to run the ZFS Test Suite (ZTS), then <code class="docutils literal notranslate"><span class="pre">ksh</span></code> and a few
additional utilities must be installed.</p>
<ul class="simple">
<li><strong>RHEL/CentOS 7:</strong></li>
</ul>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">ksh</span> <span class="n">bc</span> <span class="n">fio</span> <span class="n">acl</span> <span class="n">sysstat</span> <span class="n">mdadm</span> <span class="n">lsscsi</span> <span class="n">parted</span> <span class="n">attr</span> <span class="n">dbench</span> <span class="n">nfs</span><span class="o">-</span><span class="n">utils</span> <span class="n">samba</span> <span class="n">rng</span><span class="o">-</span><span class="n">tools</span> <span class="n">pax</span> <span class="n">perf</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>RHEL/CentOS 8, Fedora:</strong></li>
</ul>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dnf</span> <span class="n">install</span> <span class="n">ksh</span> <span class="n">bc</span> <span class="n">fio</span> <span class="n">acl</span> <span class="n">sysstat</span> <span class="n">mdadm</span> <span class="n">lsscsi</span> <span class="n">parted</span> <span class="n">attr</span> <span class="n">dbench</span> <span class="n">nfs</span><span class="o">-</span><span class="n">utils</span> <span class="n">samba</span> <span class="n">rng</span><span class="o">-</span><span class="n">tools</span> <span class="n">pax</span> <span class="n">perf</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Debian, Ubuntu:</strong></li>
</ul>
<div class="code sh highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">ksh</span> <span class="n">bc</span> <span class="n">fio</span> <span class="n">acl</span> <span class="n">sysstat</span> <span class="n">mdadm</span> <span class="n">lsscsi</span> <span class="n">parted</span> <span class="n">attr</span> <span class="n">dbench</span> <span class="n">nfs</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="n">server</span> <span class="n">samba</span> <span class="n">rng</span><span class="o">-</span><span class="n">tools</span> <span class="n">pax</span> <span class="n">linux</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">common</span> <span class="n">selinux</span><span class="o">-</span><span class="n">utils</span> <span class="n">quota</span>
</pre></div>
</div>
<p>There are a few helper scripts provided in the top-level scripts
directory designed to aid developers working with in-tree builds.</p>
<ul class="simple">
<li><strong>zfs-helper.sh:</strong> Certain functionality (i.e. /dev/zvol/) depends on
the ZFS provided udev helper scripts being installed on the system.
This script can be used to create symlinks on the system from the
installation location to the in-tree helper. These links must be in
place to successfully run the ZFS Test Suite. The <strong>-i</strong> and <strong>-r</strong>
options can be used to install and remove the symlinks.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">zfs</span><span class="o">-</span><span class="n">helpers</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>zfs.sh:</strong> The freshly built kernel modules can be loaded using
<code class="docutils literal notranslate"><span class="pre">zfs.sh</span></code>. This script can latter be used to unload the kernel
modules with the <strong>-u</strong> option.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">zfs</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>zloop.sh:</strong> A wrapper to run ztest repeatedly with randomized
arguments. The ztest command is a user space stress test designed to
detect correctness issues by concurrently running a random set of
test cases. If a crash is encountered, the ztest logs, any associated
vdev files, and core file (if one exists) are collected and moved to
the output directory for analysis.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">zloop</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>zfs-tests.sh:</strong> A wrapper which can be used to launch the ZFS Test
Suite. Three loopback devices are created on top of sparse files
located in <code class="docutils literal notranslate"><span class="pre">/var/tmp/</span></code> and used for the regression test. Detailed
directions for the ZFS Test Suite can be found in the
<a class="reference external" href="https://github.com/zfsonlinux/zfs/tree/master/tests">README</a>
located in the top-level tests directory.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">scripts</span><span class="o">/</span><span class="n">zfs</span><span class="o">-</span><span class="n">tests</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">vx</span>
</pre></div>
</div>
<p><strong>tip:</strong> The <strong>delegate</strong> tests will be skipped unless group read
permission is set on the zfs directory and its parents.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static//img/320px-Open-ZFS-Secondary-Logo-Colour-halfsize.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Getting Started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Project and Community/index.html">Project and Community</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Resources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Custom Packages.html">Custom Packages</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building ZFS</a></li>
<li class="toctree-l2"><a class="reference external" href="http://build.zfsonlinux.org/tgrid?length=100&amp;branch=master&amp;category=Platforms&amp;rev_order=desc">Buildbot Status</a></li>
<li class="toctree-l2"><a class="reference external" href="http://build.zfsonlinux.org/known-issues.html">Buildbot Issue Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="Buildbot Options.html">Buildbot Options</a></li>
<li class="toctree-l2"><a class="reference external" href="http://build.zfsonlinux.org/openzfs-tracking.html">OpenZFS Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="OpenZFS Patches.html">OpenZFS Patches</a></li>
<li class="toctree-l2"><a class="reference internal" href="OpenZFS Exceptions.html">OpenZFS Exceptions</a></li>
<li class="toctree-l2"><a class="reference external" href="http://open-zfs.org/wiki/Developer_resources">OpenZFS Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Git and GitHub for beginners.html">Git and GitHub for beginners (ZoL edition)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Performance and tuning/index.html">Performance and tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Basics concepts/index.html">Basic concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../License.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Developer Resources</a><ul>
      <li>Previous: <a href="Custom Packages.html" title="previous chapter">Custom Packages</a></li>
      <li>Next: <a href="Buildbot Options.html" title="next chapter">Buildbot Options</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, OpenZFS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Developer Resources/Building ZFS.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>