
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Troubleshooting &#8212; OpenZFS  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="dRAID Howto" href="dRAID Howto.html" />
    <link rel="prev" title="Checksums and Their Use in ZFS" href="Checksums.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">This page is a draft.</p>
</div>
<p>This page contains tips for troubleshooting ZFS on Linux and what info
developers might want for bug triage.</p>
<ul class="simple">
<li><a class="reference external" href="#about-log-files">About Log Files</a><ul>
<li><a class="reference external" href="#generic-kernel-log">Generic Kernel Log</a></li>
<li><a class="reference external" href="#zfs-kernel-module-debug-messages">ZFS Kernel Module Debug
Messages</a></li>
</ul>
</li>
<li><a class="reference external" href="#unkillable-process">Unkillable Process</a></li>
<li><a class="reference external" href="#zfs-events">ZFS Events</a></li>
</ul>
<hr class="docutils" />
<div class="section" id="about-log-files">
<h2>About Log Files<a class="headerlink" href="#about-log-files" title="Permalink to this headline">¶</a></h2>
<p>Log files can be very useful for troubleshooting. In some cases,
interesting information is stored in multiple log files that are
correlated to system events.</p>
<p>Pro tip: logging infrastructure tools like <em>elasticsearch</em>, <em>fluentd</em>,
<em>influxdb</em>, or <em>splunk</em> can simplify log analysis and event correlation.</p>
<div class="section" id="generic-kernel-log">
<h3>Generic Kernel Log<a class="headerlink" href="#generic-kernel-log" title="Permalink to this headline">¶</a></h3>
<p>Typically, Linux kernel log messages are available from <code class="docutils literal notranslate"><span class="pre">dmesg</span> <span class="pre">-T</span></code>,
<code class="docutils literal notranslate"><span class="pre">/var/log/syslog</span></code>, or where kernel log messages are sent (eg by
<code class="docutils literal notranslate"><span class="pre">rsyslogd</span></code>).</p>
</div>
<div class="section" id="zfs-kernel-module-debug-messages">
<h3>ZFS Kernel Module Debug Messages<a class="headerlink" href="#zfs-kernel-module-debug-messages" title="Permalink to this headline">¶</a></h3>
<p>The ZFS kernel modules use an internal log buffer for detailed logging
information. This log information is available in the pseudo file
<code class="docutils literal notranslate"><span class="pre">/proc/spl/kstat/zfs/dbgmsg</span></code> for ZFS builds where ZFS module parameter
<a class="reference external" href="https://github.com/zfsonlinux/zfs/wiki/ZFS-on-Linux-Module-Parameters#zfs_dbgmsg_enable">zfs_dbgmsg_enable =
1</a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="unkillable-process">
<h2>Unkillable Process<a class="headerlink" href="#unkillable-process" title="Permalink to this headline">¶</a></h2>
<p>Symptom: <code class="docutils literal notranslate"><span class="pre">zfs</span></code> or <code class="docutils literal notranslate"><span class="pre">zpool</span></code> command appear hung, does not return, and
is not killable</p>
<p>Likely cause: kernel thread hung or panic</p>
<p>Log files of interest: <a class="reference external" href="#generic-kernel-log">Generic Kernel Log</a>,
<a class="reference external" href="#zfs-kernel-module-debug-messages">ZFS Kernel Module Debug Messages</a></p>
<p>Important information: if a kernel thread is stuck, then a backtrace of
the stuck thread can be in the logs. In some cases, the stuck thread is
not logged until the deadman timer expires. See also <a class="reference external" href="https://github.com/zfsonlinux/zfs/wiki/ZFS-on-Linux-Module-Parameters#debug">debug
tunables</a></p>
</div>
<hr class="docutils" />
<div class="section" id="zfs-events">
<h2>ZFS Events<a class="headerlink" href="#zfs-events" title="Permalink to this headline">¶</a></h2>
<p>ZFS uses an event-based messaging interface for communication of
important events to other consumers running on the system. The ZFS Event
Daemon (zed) is a userland daemon that listens for these events and
processes them. zed is extensible so you can write shell scripts or
other programs that subscribe to events and take action. For example,
the script usually installed at <code class="docutils literal notranslate"><span class="pre">/etc/zfs/zed.d/all-syslog.sh</span></code> writes
a formatted event message to <code class="docutils literal notranslate"><span class="pre">syslog.</span></code> See the man page for <code class="docutils literal notranslate"><span class="pre">zed(8)</span></code>
for more information.</p>
<p>A history of events is also available via the <code class="docutils literal notranslate"><span class="pre">zpool</span> <span class="pre">events</span></code> command.
This history begins at ZFS kernel module load and includes events from
any pool. These events are stored in RAM and limited in count to a value
determined by the kernel tunable
<a class="reference external" href="https://github.com/zfsonlinux/zfs/wiki/ZFS-on-Linux-Module-Parameters#zfs_zevent_len_max">zfs_event_len_max</a>.
<code class="docutils literal notranslate"><span class="pre">zed</span></code> has an internal throttling mechanism to prevent overconsumption
of system resources processing ZFS events.</p>
<p>More detailed information about events is observable using
<code class="docutils literal notranslate"><span class="pre">zpool</span> <span class="pre">events</span> <span class="pre">-v</span></code> The contents of the verbose events is subject to
change, based on the event and information available at the time of the
event.</p>
<p>Each event has a class identifier used for filtering event types.
Commonly seen events are those related to pool management with class
<code class="docutils literal notranslate"><span class="pre">sysevent.fs.zfs.*</span></code> including import, export, configuration updates,
and <code class="docutils literal notranslate"><span class="pre">zpool</span> <span class="pre">history</span></code> updates.</p>
<p>Events related to errors are reported as class <code class="docutils literal notranslate"><span class="pre">ereport.*</span></code> These can
be invaluable for troubleshooting. Some faults can cause multiple
ereports as various layers of the software deal with the fault. For
example, on a simple pool without parity protection, a faulty disk could
cause an <code class="docutils literal notranslate"><span class="pre">ereport.io</span></code> during a read from the disk that results in an
<code class="docutils literal notranslate"><span class="pre">erport.fs.zfs.checksum</span></code> at the pool level. These events are also
reflected by the error counters observed in <code class="docutils literal notranslate"><span class="pre">zpool</span> <span class="pre">status</span></code> If you see
checksum or read/write errors in <code class="docutils literal notranslate"><span class="pre">zpool</span> <span class="pre">status</span></code> then there should be
one or more corresponding ereports in the <code class="docutils literal notranslate"><span class="pre">zpool</span> <span class="pre">events</span></code> output.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static//img/320px-Open-ZFS-Secondary-Logo-Colour-halfsize.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Getting Started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Project and Community/index.html">Project and Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Developer Resources/index.html">Developer Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Performance and tuning/index.html">Performance and tuning</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Basic concepts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Checksums.html">Checksums and Their Use in ZFS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="dRAID Howto.html">dRAID Howto</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../License.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Basic concepts</a><ul>
      <li>Previous: <a href="Checksums.html" title="previous chapter">Checksums and Their Use in ZFS</a></li>
      <li>Next: <a href="dRAID Howto.html" title="next chapter">dRAID Howto</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, OpenZFS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Basics concepts/Troubleshooting.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>